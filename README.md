# Домашнее задание к занятию "Резервное копирование баз данных" - Tarkov Viktor


### Инструкция по выполнению домашнего задания

   1. Сделайте `fork` данного репозитория к себе в Github и переименуйте его по названию или номеру занятия, например, https://github.com/имя-вашего-репозитория/git-hw или  https://github.com/имя-вашего-репозитория/7-1-ansible-hw).
   2. Выполните клонирование данного репозитория к себе на ПК с помощью команды `git clone`.
   3. Выполните домашнее задание и заполните у себя локально этот файл README.md:
      - впишите вверху название занятия и вашу фамилию и имя
      - в каждом задании добавьте решение в требуемом виде (текст/код/скриншоты/ссылка)
      - для корректного добавления скриншотов воспользуйтесь [инструкцией "Как вставить скриншот в шаблон с решением](https://github.com/netology-code/sys-pattern-homework/blob/main/screen-instruction.md)
      - при оформлении используйте возможности языка разметки md (коротко об этом можно посмотреть в [инструкции  по MarkDown](https://github.com/netology-code/sys-pattern-homework/blob/main/md-instruction.md))
   4. После завершения работы над домашним заданием сделайте коммит (`git commit -m "comment"`) и отправьте его на Github (`git push origin`);
   5. Для проверки домашнего задания преподавателем в личном кабинете прикрепите и отправьте ссылку на решение в виде md-файла в вашем Github.
   6. Любые вопросы по выполнению заданий спрашивайте в чате учебной группы и/или в разделе “Вопросы по заданию” в личном кабинете.
   
Желаем успехов в выполнении домашнего задания!
   
### Дополнительные материалы, которые могут быть полезны для выполнения задания

1. [Руководство по оформлению Markdown файлов](https://gist.github.com/Jekins/2bf2d0638163f1294637#Code)

---

### Задание 1. Резервное копирование

Кейс

Финансовая компания решила увеличить надёжность работы баз данных и их резервного копирования.

Необходимо описать, какие варианты резервного копирования подходят в случаях:

*1.1. Необходимо восстанавливать данные в полном объёме за предыдущий день.*

Для восстановления данных за предыдущий день в полном объёме лучше всего подходят:

   - Полное резервное копирование, если позволяют ресурсы (время и место для хранения).
   - Дифференциальное резервное копирование в сочетании с периодическим полным резервным копированием — это оптимальный баланс между временем создания копий, размером хранилища и скоростью восстановления.

Эта стратегия позволит компании обеспечить надёжность и своевременность восстановления баз данных за нужный промежуток времени. 

*1.2. Необходимо восстанавливать данные за час до предполагаемой поломки.*

Если требуется восстановить данные за час до предполагаемой поломки, это означает, что система резервного копирования должна обеспечивать минимальную потерю данных (RPO — Recovery Point Objective) не более чем за час, а также достаточно быстрое восстановление (RTO — Recovery Time Objective).
Для решения таких задач подойдет Инкрементное резервное копирование с частым созданием снимков — сохраняет только изменения, произошедшие с момента последнего резервного копирования, что позволяет создавать копии данных очень часто (например, каждый час). Это сводит к минимуму риск потери данных.

*1.3. Возможен ли кейс, когда при поломке базы происходило моментальное переключение на работающую или починенную базу данных.*

Да, возможен. Репликация. В случае поломки БД и краха Master-сервера можно назначить «новый Master-сервер» на один из Slave-серверов и перенаправить клиентов на него. После устранения неисправностей делается обратное переназначение и перенаправление.

Приведите ответ в свободной форме.

---

### Задание 2. PostgreSQL

*2.1. С помощью официальной документации приведите пример команды резервирования данных и восстановления БД (pgdump/pgrestore).*

Приведите ответ в свободной форме.

Выгрузка базы данных mydb в файл SQL-скрипта:
```python
pg_dump mydb > db.sql
```
Выгрузка базы данных в специальном формате:
```python
pg_dump -Fc mydb > db.dump
```
Чтобы восстановить из архива в чистую новую базу данных  под названием newdb:
```python
createdb -T template0 newdb
pg_restore -d newdb db.dump
```
[Документация pgdump](https://postgrespro.ru/docs/postgresql/17/app-pgdump)

[Документация pgrestore](https://www.postgresql.org/docs/current/app-pgrestore.html)

---

### Задание 3. MySQL

*3.1. С помощью официальной документации приведите пример команды инкрементного резервного копирования базы данных MySQL.*

Приведите ответ в свободной форме.

Так как инкрементное резервное копирование использует полную копию как начальную точку, то сначала нужно сделать полную резервную копию. Далее выполняется инкрементное резервное копирование. 

В примере используется опция --incremental-base=history:last_backup , с помощью которой mysqlbackup извлекает LSN последней успешной (не TTS) полной или частичной резервной копии из таблицы mysql.backup_history и на его основе выполняет инкрементное резервное копирование.
```python
mysqlbackup --defaults-file=/home/dbadmin/my.cnf \
  --incremental --incremental-base=history:last_backup \
  --backup-dir=/home/dbadmin/temp_dir \
  --backup-image=incremental_image1.bi \
   backup-to-image
```

Также резервное копирование можно осуществить с использованием инструмента Percona XtraBackup (часто рекомендуемый и задокументированный способ) выглядит следующим образом:
```python
xtrabackup --backup --target-dir=/путь/к/инкрементному_бэкапу --incremental-basedir=/путь/к/последнему_полному_бэкапу
```

Расшифровка:
   - --backup — режим создания резервной копии.
   - --target-dir — каталог, в который будет сохранена инкрементная копия.
   - --incremental-basedir — путь к каталогу с последней полной (или предыдущей инкрементной) резервной копией, относительно которой создаётся инкрементная копия.

Пример:
```python
xtrabackup --backup --target-dir=/root/backupdb/inc1 --incremental-basedir=/root/backupdb/full
```

Здесь /root/backupdb/full — полная резервная копия, а /root/backupdb/inc1 — папка для инкрементального резервного копирования.


[Документация MySQL](https://dev.mysql.com/doc/mysql-enterprise-backup/9.4/en/mysqlbackup.incremental.html)


---
